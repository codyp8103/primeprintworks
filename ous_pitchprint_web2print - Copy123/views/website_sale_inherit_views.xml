<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <template id="pitchprint_product_page" name="PitchPrint Product" inherit_id="website_sale.product" priority="10" customize_show="False">
            <xpath expr="//div[@id='product_option_block']" position="after">
                <t t-if="product.is_pitchprint_design and product.pitchprint_design_id">
                    <t t-set="api_key" t-value="request.env['ir.config_parameter'].sudo().get_param('ous_pitchprint_web2print.api_key')"/>
                    <t t-set="pitchprint_design_id" t-value="product.pitchprint_design_id.design_id"/>
                    <div id="pp_wrapper" class="mt-2">
                        <script src="https://pitchprint.io/rsc/js/client.js"></script>
                        <script>
                            var ppApiKey = "<t t-esc='api_key'/>";
                            var ppDesignId = "<t t-esc='pitchprint_design_id'/>";
                            var ppProductId = "<t t-esc='product_variant.id'/>";
                            var ppProductName = "<t t-esc='product.name'/>";
                            var ppUserEmail = "<t t-esc='user_id.email'/>";
                            var ppUserName = "<t t-esc='user_id.name'/>";
                        </script>
                        <select id="pp_design_select" style="display: none;"></select>
                        <a role="button" id="launch_btn" class="btn btn-secondary flex-grow-1 me-2 mr-2" href="#" style="display:none;">
                        <i class="fa fa-pencil mr-2 me-2"/>CUSTOMISE</a>
                        <a role="button" id="reset_btn" class="btn btn-warning flex-grow-1" href="#" style="display:none;">
                        <i class="fa fa-trash mr-2 me-2"/>RESET DESIGNS</a>
                        <div id="pp_loader_div" style="display:none;"><img src="https://pitchprint.io/rsc/images/loaders/spinner_new.svg"/></div>
                    </div>
                </t>
            </xpath>
            <xpath expr="//a[@id='add_to_cart']" position="attributes">
                <attribute name="t-attf-style">display: {{'none !important' if product.is_pitchprint_design else 'inline-block'}};</attribute>
            </xpath>
        </template>
        <template id="pitchprint_cart_line_id" name="PitchPrint Cart Ref" inherit_id="website_sale.cart_line_description_following_lines" customize_show="True">
            <xpath expr="//div[1]" position="after">
                <t t-if="line.pitchprint_project_id">
                    <div class="text-muted d-none d-md-block small">
                        <span>ID:<t t-out="line.pitchprint_project_id or line.id"/></span>
                    </div>
                </t>
            </xpath>
        </template>
        <template id="pitchprint_cart_line" name="PitchPrint Cart Preview" inherit_id="website_sale.cart_lines" customize_show="False">
            <xpath expr="//div[@id='cart_products']/div[1]/t[1]/div[1]" position="after">
                <t t-if="line.pitchprint_project_id">
                    <div>
                        <a t-attf-href="https://pitchprint.io/previews/{{line.pitchprint_project_id}}_1.jpg" target="_blank" style="text-decoration:none">
                            <img t-attf-src="https://pitchprint.io/previews/{{line.pitchprint_project_id}}_1.jpg" class="img o_image_64_max" t-att-alt="line.name_short"/>
                        </a>
                        <br/>
                        <a t-attf-href="https://png.pitchprint.com/{{line.pitchprint_project_id}}" target="_blank">
                            <span class="badge bg-secondary badge-secondary">Review Design</span>
                        </a>
                    </div>
                </t>
            </xpath>
        </template>
    </data>
</odoo>